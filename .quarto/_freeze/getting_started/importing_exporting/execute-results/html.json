{
  "hash": "abf64107fc44ee26b8f827b45e8864e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Importing, exporting data\nengine: knitr\nformat: live-html\nwebr:\n  packages:\n    - dplyr\n    - readxl\n    - readr\nresources:\n  - images\n  - data\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\n#| output: false\nwebr::install(\"gradethis\", quiet = TRUE)\nlibrary(gradethis)\noptions(webr.exercise.checker = function(\n  label, user_code, solution_code, check_code, envir_result, evaluate_result,\n  envir_prep, last_value, engine, stage, ...\n) {\n  if (is.null(check_code)) {\n    # No grading code, so just skip grading\n    invisible(NULL)\n  } else if (is.null(label)) {\n    list(\n      correct = FALSE,\n      type = \"warning\",\n      message = \"All exercises must have a label.\"\n    )\n  } else if (is.null(solution_code)) {\n    list(\n      correct = FALSE,\n      type = \"warning\",\n      message = htmltools::tags$div(\n        htmltools::tags$p(\"A problem occurred grading this exercise.\"),\n        htmltools::tags$p(\n          \"No solution code was found. Note that grading exercises using the \",\n          htmltools::tags$code(\"gradethis\"),\n          \"package requires a model solution to be included in the document.\"\n        )\n      )\n    )\n  } else {\n    gradethis::gradethis_exercise_checker(\n      label = label, solution_code = solution_code, user_code = user_code,\n      check_code = check_code, envir_result = envir_result,\n      evaluate_result = evaluate_result, envir_prep = envir_prep,\n      last_value = last_value, stage = stage, engine = engine)\n  }\n})\n```\n:::\n\n\n\n\n\n\n## CSV files\n\nComma separated files are the most common way to save spreadsheets that doesn't require a paid program from Microsoft to open.\n\n### What a csv file looks like\n\nCSV file names end with a **.csv**\n\n![](images/csv1.png?classes=shadow){width=100%}\n\n\n### What a csv file looks like on the inside**\n\nThis explains the values separated with commas part of the file name.\n\n![](images/csv2.png?classes=shadow){width=100%}\n\n## Importing CSV files\n\n- Importing CSV is part of base R, no package needed\n- But we're going to use a package anyway, **readr**\n\n**Two ways to get data**\n\n* If you have the URL address\n    * If the csv file exists on the internet, you don’t have to download it to your local machine and then import it, you can import it to R directly from the web using the link\n* If you have the file on your computer\n\n### Get the URL\n\nIf you have the link to a CSV file, right click [the link](https://data.ct.gov/Health-and-Human-Services/Admissions-to-DMHAS-Addiction-Treatment-by-Town-Ye/iyru-82zq/data) of the data and click **Copy Link Address**. This data set can be found on the [Connecticut Open Data Portal](https://data.ct.gov/Health-and-Human-Services/Admissions-to-DMHAS-Addiction-Treatment-by-Town-Ye/iyru-82zq/). **NOTE:** This data is no longer available. Download it instead from [here](https://www.andrewbatran.com/data/Admissions_to_DMHAS_Addiction_Treatment_by_Town__Year__and_Month.csv).\n\n![](images/rightclick.png?classes=shadow){width=100%}\n\n### read.csv()\n\nThe Base R function to import a CSV file is `read.csv()`. Just put the URL address in quotation marks and add the `stringsAsFactors=F` (In this code we're using the function `head()`-- this returns 6 rows by default, but we want to look at 10, so we’ll specify that when we call the function head(data, 10))\n\nClick `RUN CODE` to import the data from a  website and look at the first 10 rows.\n\n\n\n\n::: {.cell}\n```{webr}\n#df_csv <- read.csv(\"https://data.ct.gov/api/views/rybz-nyjw/rows.csv?accessType=DOWNLOAD&api_foundry=true\", stringsAsFactors=F)\n\ndf <- read.csv(\"https://www.andrewbatran.com/data/Admissions_to_DMHAS_Addiction_Treatment_by_Town__Year__and_Month.csv\", stringsAsFactors=F)\n\n\nhead(df_csv, 10)\n```\n:::\n\n\n\n\n\n### Other way: Download it first\n\nWhen you right click on the link, instead of clicking **Copy Link Address**-- this time, click **Save Link As...**\n\n![](images/downloading.png?classes=shadow){width=100%}\n\nSave to your working directory.\n\nAfter saving to the directory, click on the circle arrow on the right to refresh the files to make sure it's there.\n\n![](images/directory.png?classes=shadow){width=100%}\n\n### Recall: How to change directories in RStudio\n\nEither by typing `setwd(\"/directory/where/you/want\")` or by clicking in the menu up top **Session > Set Working Directory > Choose Directory...**\n\n![](images/setwd.png?classes=shadow){width=100%}\n\n### Importing local csv data\n\nJust like before, except instead of the URL, it's the name of the file.\n\n**Note:** This will only work if the working directory is set to where the csv file is.\n\n### Using read_csv() from the readr package\n\n**readr** is a package that read rectangular data quickly and assumes characters are strings and not factors by default.\n\n\n\n\n::: {.cell}\n```{webr}\n## If you don't have readr installed yet, uncomment and run the line below\n#install.packages(\"readr\")\nlibrary(readr)\ndf_csv <- read_csv(\"https://www.andrewbatran.com/data/Admissions_to_DMHAS_Addiction_Treatment_by_Town__Year__and_Month.csv\")\n\n```\n:::\n\n\n\n\nAs you can see, the `read_csv()` function interpreted the **MonthYear** and **Town** columns as characters and not as Factors as `read.csv()` did.\n\n## Exporting CSV files\n\nWhen you're done analyzing or transforming your data, you can save your dataframe as a CSV file with `write_csv()` from the **readr** package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pass the write_csv() function the name of the dataframe and what you want to call the file\nwrite_csv(df_csv, \"transformed_data.csv\")\n```\n:::\n\n\n\n\nThe file will save to your working directory, but you can specify sub directories with the function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pass the write_csv() function the name of the dataframe and what you want to call the file\nwrite_csv(df_csv, \"data/transformed_data.csv\")\n```\n:::\n\n\n\n\n### Exporting data frames with `NA` \n\nWeird quirk alert: Exported files will include `NA`s so to replace them, pass the variable `na=\"whatever\"`. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# This replaces the NAs with blanks\nwrite_csv(df_csv, \"data/transformed_data.csv\", na=\"\")\n```\n:::\n\n\n\n\n\n## Your turn\n\n**When exporting a csv, how do you get rid of NAs with the readr package?**\n\n\n\n\n```{ojs}\n//| echo: false\nmutable ok_reponse1 = (reponse, n) => { return html`Loading...` };\nviewof reponse1 = Inputs.radio(\n  new Map([\n    ['write.csv(df_csv, \"data/transformed_data.csv\", is.na=F)', 1],\n    ['write_csv(df_csv, \"data/transformed_data.csv\", N.A=\"\")', 2],\n    ['write.csv(df_csv, \"data/transformed_data.csv\", na=\"\")', 3],\n    ['write_csv(df_csv, \"data/transformed_data.csv\", na=\"\")', 4]\n  ])\n);\nok_reponse1(reponse1, 4);\n```\n\n\n\n\n\n## Importing an Excel file\n\nExcel spreadsheets are unique in that they can contain multiple spreadsheets as a workbook.\n\n### What an Excel file looks like\n\nExcel file names end with a **.xls** or **.xlsx**\n\n![](images/excel1.png?classes=shadow){width=100%}\n\n### What an Excel file looks like on the inside\n\nWeird, right? Definitely difficult to parse.\n\n![](images/excel2.png?classes=shadow){width=100%}\n\nWhat I do sometimes (often) is save a sheet from Excel as a .csv file.\n\nThat's a short cut. But if you want to be transparent and really deal with the raw data then:\n\n## Importing Excel files\n- Importing Excel is complicated, **readxl package** is needed\n- There are more other packages that handle Excel files and can build extra sheets, but we won't be needing them for this instance\n\nFirst, install the `readxl` package if you have not yet done so. \n\nThat will have `readxl` as part of the group of packages.\n\n\n\n\n::: {.cell}\n```{webr}\n## If you don't have readxl installed, uncomment the line below and run it \n#install.packages(\"readxl\")\nlibrary(readxl)\n```\n:::\n\n\n\n\nUnlike a csv, you can't just copy and paste the URL for an Excel sheet. \n\nYou gotta download the file first.\n\nVisit this link of [Excel data link](https://www.dropbox.com/scl/fi/sf7rjfsstsm1520z0xhum/StatisticsSummary.xls?dl=0&rlkey=j8frar23albdjx1b006onm48s) on Dropbox and click **Download**\n\n\n\n### read_excel()\n\nExcel spreadsheets have multiple sheets and it's best to explore what it looks like in Excel first because `read_excel()` requires specific sheets to be referred to when importing.\n\nGive it a shot with the first sheet.\n\n```\ndf_xl <- read_excel(\"data/StatisticsSummary.xls\", sheet=1)\n```\n\nCheck it\n\n```\nView(df_xl)\n```\n\n![](images/excel_imported.png?classes=shadow){width=100%}\n\n\n**This isn't right**. \n\n## Dealing with ugly data\n\nThe problem with Excel files is that people love to format it in ways that make it look nice in Excel but makes no sense in R.\n\n### read_excel() again\n\n\nBut this time we'll add `skip=2` so it skips the first rows when bringing in the data.\n\n\n\n\n::: {.cell}\n```{webr}\ndf_xl <- read_excel(\"data/StatisticsSummary.xls\", sheet=1, skip=2)\n```\n:::\n\n\n\n\nMuch better\n\n```\nView(df_xl)\n```\n\n![](images/excel_imported2.png?classes=shadow){width=100%}\n\n*Notice that the column names are preserved with spaces and symbols.*\n\n\n\n\n\n\n::: {.cell}\n```{webr}\n# the colnames() function lists the column names of the dataframe\ncolnames(df_xl)\n```\n:::\n\n\n\n\nSo how would one refer to the data in the columns with spaces\n\nIf we did it like normal with the `$` to pull the column we'd try\n\n\n\n\n::: {.cell}\n```{webr}\nhead(df_xl$Other Cases)\n```\n:::\n\n\n\n\nSee, spaces won't work. This is how to deal with columns with spaces-- add the back tick next to the 1 button on your keyboard.\n\n\n\n\n::: {.cell}\n```{webr}\nhead(df_xl$`Other Cases`)\n```\n:::\n\n\n\n\nIt's some extra finger work that you might be okay with if it was in a limited basis.\n\nHowever, in anticipation of the work we're going to be doing, we should go ahead and simplify the column names so there are no characters or spaces. We're going to load a new package called **[janitor](http://sfirke.github.io/janitor/)**. Its job is to exclusively clean names.\n\n\n\n\n::: {.cell}\n```{webr}\n#install.packages(\"janitor\")\n\nlibrary(janitor)\n\ndf_xl <- clean_names(df_xl)\n\ncolnames(df_xl)\n```\n:::\n\n\n\n\nCompare the column names from this to the ones above. There are no capitalization and the spaces are replaced with `_` and this will be much easier to work with in R.\n\n## Exporting to Excel\n\nIt's preferable to save data frames as CSVs because it's more open and doesn't require a paid program for others to open.\n\nBut sometimes it's more economical to push out a bunch of sheets into one workbook (that's the perk of Excel, after all).\n\nWe won't get into that now but if you're curious, you can explore that in the the links below.\n\n* [Using the xlsx package](http://www.sthda.com/english/wiki/writing-data-from-r-to-excel-files-xls-xlsx)\n* [Reading and importing Excel files into R](https://www.datacamp.com/community/tutorials/r-tutorial-read-excel-into-r)\n\n\n## Your turn again\n\n**If you import an Excel file and it has 5 buffer rows at the top before the real data starts, how do you deal with that using the *readxl* package?**\n\n\n\n\n```{ojs}\n//| echo: false\nmutable ok_reponse2 = (reponse, n) => { return html`Loading...` };\nviewof reponse2 = Inputs.radio(\n  new Map([\n    ['read_excel(\"stats.xls\", sheet=1, row=5)', 1],\n    ['read_excel(\"stats.xls\", sheet=1, skip=5)', 2],\n    ['read_excel(\"stats.xls\", sheet=1, row=6)', 3],\n    ['read_excel(\"stats.xls\", sheet=1, row=4)', 4]\n  ])\n);\nok_reponse2(reponse2, 2);\n```\n\n\n\n\n**If you import an Excel file and it has 5 buffer rows at the top before the real data starts, how do you deal with that using the *readxl* package?**\n\n\n\n\n```{ojs}\n//| echo: false\nmutable ok_reponse3 = (reponse, n) => { return html`Loading...` };\nviewof reponse3 = Inputs.radio(\n  new Map([\n    ['read_excel(\"stats.xls\", sheet=1, row=5)', 1],\n    ['read_excel(\"stats.xls\", sheet=1, skip=5)', 2],\n    ['read_excel(\"stats.xls\", sheet=1, row=6)', 3],\n    ['read_excel(\"stats.xls\", sheet=1, row=4)', 4]\n  ])\n);\nok_reponse3(reponse3, 2);\n```\n\n\n\n\n**What is the function from the janitor package that eliminates spaces and lowercases the text in the column names?**\n\n\n\n\n\n```{ojs}\n//| echo: false\nmutable ok_reponse4 = (reponse, n) => { return html`Loading...` };\nviewof reponse4 = Inputs.radio(\n  new Map([\n    ['janitor()', 1],\n    ['fix_columns()', 2],\n    ['make.names()', 3],\n    ['clean_names()', 4]\n  ])\n);\nok_reponse4(reponse4, 4);\n```\n\n\n\n\n## Done!\n\nGreat job. \n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}